function processData() {
    const raw = document.getElementById("rawText").value.trim();
    const lines = raw.split("\n");

    const tableBody = document.querySelector("#resultTable tbody");
    tableBody.innerHTML = "";

    lines.forEach(line => {
        const parts = line.trim().split(/\s+/);

        if (parts.length >= 7) {
            const no = parts[0];
            const day = parts[1];
            const month = parts[2];
            const year = parts[3];
            const time = parts[4] + " " + parts[5];
            const id = parts[6];

            let name = "";
            let email = "";
            let note = "-";

            const rest = parts.slice(7);
            rest.forEach(p => {
                if (p.includes("@")) {
                    email = p;
                } else if (p === "-") {
                    note = p;
                } else {
                    name += (name ? " " : "") + p;
                }
            });

            const date = `${day} ${month} ${year}`;

            const tr = document.createElement("tr");
            [no, date, time, id, name, email, note].forEach(val => {
                const td = document.createElement("td");
                td.textContent = val;
                tr.appendChild(td);
            });

            tableBody.appendChild(tr);
        }
    });
}



function downloadPDF() {
    const table = document.getElementById("resultTable");
    if (!table || table.rows.length <= 1) {
        alert("ไม่มีข้อมูลในตารางให้ดาวน์โหลดค่ะ");
        return;
    }

    const opt = {
        margin: [10, 10, 10, 10],
        filename: 'attendance.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 1.5, useCORS: true },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };

    html2pdf().set(opt).from(table).save();
}
